create database JVRPDATABASE;
use JVRPDATABASE;

CREATE TABLE usuarios (
  id_usuario int(6) unsigned auto_increment not null primary key,
  nombre varchar(64) NOT NULL,
  contrasena varbinary(256) NOT NULL
);
CREATE TABLE acceso (
  id_acceso int(6) unsigned auto_increment not null primary key,
  seccion varchar(64) NOT NULL,
	tipo varchar(2) not null
);
CREATE TABLE UsTieneAcceso (
  id_usuario int(6) unsigned not null,
  id_acceso int(6) unsigned not null,
  PRIMARY KEY (id_usuario,id_acceso),
  KEY id_acceso (id_acceso),
  CONSTRAINT UsTieneAcceso_ibfk_1 FOREIGN KEY (id_usuario) REFERENCES usuarios (id_usuario),
  CONSTRAINT UsTieneAcceso_ibfk_2 FOREIGN KEY (id_acceso) REFERENCES acceso (id_acceso)
);
create table Programa
	(
	ID_Programa int(6) unsigned auto_increment not null primary key,
	Nombre_Programa varchar(64) not null,
	Descripcion varchar(256),
	Fecha_Finalizacion datetime
	);

create table FechaPrograma
	(
	Fecha date, 
	Hora_Inicio time not null, 
	Hora_Fin time not null, 
	ID_Programa int(6) unsigned, 
	foreign key (ID_Programa ) references Programa(ID_Programa),
	primary key(Fecha, Hora_Inicio));
create table ProgramaCuota
	(
	ID_Programa_Cuota int(6) unsigned not null,
	ID_Programa int(6) unsigned not null,
	Fecha_Pago date,
	Precio int(5) unsigned not null,
	Fecha_Emision date not null,
	primary key(ID_Programa_Cuota),
	foreign key (ID_Programa ) references Programa(ID_Programa)
	);

create table Empresa
	(
	ID_Empresa int(6) unsigned auto_increment not null primary key,
	Nombre varchar(64) not null,
	Telefono int(9) unsigned
	);

create table Publicidad
	(
	ID_Publicidad int(6) unsigned auto_increment not null primary key,
	Tema varchar(256) not null,
	ID_Empresa int(6) unsigned not null,
	foreign key (ID_Empresa ) references Empresa(ID_Empresa)
	);

create table PMuestraPubli 
	(ID_Publicidad int(6) unsigned not null,
	ID_Programa int(6) unsigned not null,
	Fecha_Inicio date not null,
	Fecha_Finalizacion date,
	primary key(Fecha_Inicio,ID_Programa,ID_Publicidad),
	foreign key (ID_Programa ) references Programa(ID_Programa),
	foreign key (ID_Publicidad ) references Publicidad(ID_Publicidad)
	);
create table PublicidadCuota
	(
	ID_PublicidadCuota int(6) unsigned auto_increment not null primary key,
	Fecha_Pago date,
	Precio int(6) unsigned not null,
	ID_Publicidad int(6) unsigned not null,
	foreign key (ID_Publicidad ) references Publicidad(ID_Publicidad)
	);


create table Tanda
	(
	Hora_Inicio time not null,
	Hora_Fin time not null,
	Primary key (Hora_Inicio)
	);
create table AparecePubli
	(
	ID_Publicidad int(6) unsigned not null,
	Hora_Inicio time not null,
	Fecha_Inicio date not null,
	Fecha_Finalizacion date,
	primary key(ID_Publicidad,Hora_Inicio, Fecha_Inicio),
	foreign key (ID_Publicidad ) references Publicidad(ID_Publicidad),
	foreign key (Hora_Inicio ) references Tanda(Hora_Inicio)
	);


create table Evento
	(
	ID_Evento INT(6) unsigned NOT NULL PRIMARY KEY AUTO_INCREMENT,
	nombre VARCHAR(64) NOT NULL,
	descripcion VARCHAR(256) NOT NULL
	);
	
create table FechaEvento
	(
	ID_Evento INT(6) unsigned,
	fecha DATETIME NOT NULL,
	foreign key (ID_Evento ) references Evento(ID_Evento),
	PRIMARY KEY(ID_Evento, fecha)
	);
create table EventoMuestraPubli 
	(
	ID_Evento int(6) unsigned not null,
	ID_Publicidad int(6) unsigned not null,
	primary key(ID_Evento, ID_Publicidad),
	foreign key (ID_Publicidad ) references Publicidad(ID_Publicidad),
	foreign key (ID_Evento ) references Evento(ID_Evento)
	);
create table EventoEsDeP
	(
	ID_Programa int(6) unsigned not null,
	ID_Evento int(6) unsigned not null,
	primary key(ID_Programa,ID_Evento),
	foreign key (ID_Programa ) references Programa(ID_Programa),
	foreign key (ID_Evento ) references Evento(ID_Evento)
	);
create table Funcionario
	(
	ID_Funcionario INT(6) unsigned NOT NULL PRIMARY KEY AUTO_INCREMENT,
	telefono INT(9) NOT NULL,
	nombre VARCHAR(64) NOT NULL
	);
	
create table Funcion
	(
	ID_Funcion INT(6) unsigned NOT NULL PRIMARY KEY AUTO_INCREMENT,
	descripcion VARCHAR(256) NOT NULL
	);
	
create table TrabajaComo
	(
	ID_Funcionario INT(6) unsigned,
	ID_Funcion INT(6) unsigned,
	foreign key (ID_Funcionario ) references Funcionario(ID_Funcionario),
	foreign key (ID_Funcion ) references Funcion(ID_Funcion),
	PRIMARY KEY(ID_Funcionario, ID_Funcion)
	);
	
create table FunTrabaja
	(
	ID_Funcionario INT(6) unsigned,
	ID_Funcion INT(6) unsigned,
	ID_Programa INT(6) unsigned,
	fecha_inicio DATE NOT NULL,
	fecha_finalizacion DATE,
	foreign key (ID_Funcionario ) references Funcionario(ID_Funcionario),
	foreign key (ID_Funcion ) references Funcion(ID_Funcion),
	foreign key (ID_Programa ) references Programa(ID_Programa),
	PRIMARY KEY(ID_Funcionario, ID_Funcion, ID_Programa, Fecha_Inicio)
	);
	
  

create table Video
	(
	ID_Video INT(6) unsigned NOT NULL PRIMARY KEY AUTO_INCREMENT,
	contenido VARCHAR(256) NOT NULL,
	nombre VARCHAR(64) NOT NULL,
	ID_Serie INT(6) unsigned,
	foreign key (ID_Serie ) references Serie(ID_Serie),
	fecha DATETIME
	);
	
create table Serie
	(
	ID_Serie INT(6) unsigned NOT NULL PRIMARY KEY AUTO_INCREMENT,
	fecha_finalizacion DATE,
	nombre VARCHAR(64) NOT NULL
	);
	
create table EventoEsDeV
	(
	ID_Evento INT(6) unsigned not null,
	ID_Video INT(6) unsigned not null,
	foreign key (ID_Evento ) references Evento(ID_Evento),
	foreign key (ID_Video ) references Video(ID_Video),
	PRIMARY KEY(ID_Evento, ID_Video)
	);
	